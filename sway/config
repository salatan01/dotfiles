# #######################################################################################
# FIXED SWAY CONFIGURATION (NixOS Optimized)
# #######################################################################################

### VARIABLES ###
set $mod Mod4
set $terminal ghostty
set $fileManager nemo
# Note: Ensure 'wofi' or 'rofi' is installed via Nix if 'hyprlauncher' isn't standard
set $menu wofi --show drun 
set $browser brave

### MONITORS ###
# Scale 1.25 for HiDPI
output * scale 1.25

### INPUT ###
input type:keyboard xkb_layout us

input type:touchpad {
    dwt enabled
    tap enabled
    natural_scroll disabled
    middle_emulation enabled
}

# IMPORTANT: Run 'swaymsg -t get_inputs' in a terminal to find your exact Mouse ID
# It usually looks like '1234:5678:Device_Name'
input "type:pointer" {
    pointer_accel -0.5
}

# Focus follows mouse
focus_follows_mouse yes

### LOOK AND FEEL ###

# Gaps
gaps inner 3
gaps outer 7

# Borders
default_border pixel 3
default_floating_border pixel 3

# Colors
# class                 border  backgr. text    indicator child_border
client.focused          #00ff00 #00ff00 #ffffff #2e9ef4   #00ff00
client.focused_inactive #595959 #595959 #ffffff #484e50   #595959
client.unfocused        #595959 #595959 #888888 #292d2e   #595959
client.urgent           #2f343a #900000 #ffffff #900000   #900000

### AUTOSTART ###

# Wallpaper: Keep hyprpaper if installed, or use 'swaybg'
exec hyprpaper

# Status Bar
# The reload command will automatically relaunch waybar
exec waybar

# Idle Daemon
exec hypridle

# Break timer
exec stretchly

# Polkit (NixOS FIX)
# This is the path for 'polkit-gnome' in NixOS.
# Ensure 'polkit_gnome' is in your systemPackages or home.packages.
exec /run/current-system/sw/libexec/polkit-gnome-authentication-agent-1

# Autotiling (HYPRLAND-STYLE SPIRAL FIX)
# Install 'autotiling' package in NixOS for the spiral layout
exec autotiling

### ENVIRONMENT ###
seat seat0 xcursor_theme Bibata-Modern-Classic 24

### KEYBINDINGS ###

# Applications
bindsym $mod+q exec $terminal
bindsym $mod+c kill
bindsym $mod+e exec $fileManager
bindsym $mod+v floating toggle
bindsym $mod+a exec $menu
bindsym $mod+b exec $browser

# RELOAD CONFIG (Essential Fix)
# Reloads sway config AND waybar so changes apply immediately
bindsym $mod+Shift+c reload; exec pkill -SIGUSR2 waybar

# Layout Manipulation
bindsym $mod+p splith; splitv # Rough manual spiral
bindsym $mod+m layout toggle split
bindsym $mod+f fullscreen
bindsym $mod+Shift+f fullscreen global

# Security / Session
bindsym $mod+Return exec hyprlock
bindsym $mod+Mod1+l exec wlogout
# Navigation (Vim Style)
bindsym $mod+h focus left
bindsym $mod+l focus right
bindsym $mod+k focus up
bindsym $mod+j focus down

# Moving Windows
bindsym $mod+Shift+h move left
bindsym $mod+Shift+l move right
bindsym $mod+Shift+k move up
bindsym $mod+Shift+j move down

# Workspaces
bindsym $mod+1 workspace number 1
bindsym $mod+2 workspace number 2
bindsym $mod+3 workspace number 3
bindsym $mod+4 workspace number 4
bindsym $mod+5 workspace number 5
bindsym $mod+6 workspace number 6
bindsym $mod+7 workspace number 7
bindsym $mod+8 workspace number 8
bindsym $mod+9 workspace number 9
bindsym $mod+0 workspace number 10

# Move to Workspace
bindsym $mod+Shift+1 move container to workspace number 1
bindsym $mod+Shift+2 move container to workspace number 2
bindsym $mod+Shift+3 move container to workspace number 3
bindsym $mod+Shift+4 move container to workspace number 4
bindsym $mod+Shift+5 move container to workspace number 5
bindsym $mod+Shift+6 move container to workspace number 6
bindsym $mod+Shift+7 move container to workspace number 7
bindsym $mod+Shift+8 move container to workspace number 8
bindsym $mod+Shift+9 move container to workspace number 9
bindsym $mod+Shift+0 move container to workspace number 10

# Scratchpad
bindsym $mod+s scratchpad show
bindsym $mod+Shift+s move scratchpad

# Mouse bindings
floating_modifier $mod normal

# Resizing (Based on your Y/O/U/I preference)
mode "resize" {
    bindsym y resize shrink width 30px
    bindsym o resize grow width 30px
    bindsym u resize shrink height 30px
    bindsym i resize grow height 30px

    # Exit resize mode:
    bindsym Return mode "default"
    bindsym Escape mode "default"
}
bindsym $mod+r mode "resize"

# Media Keys
# Ensure 'wpctl' (pipewire) and 'brightnessctl' are installed
bindsym --locked XF86AudioRaiseVolume exec wpctl set-volume -l 1 @DEFAULT_AUDIO_SINK@ 5%+
bindsym --locked XF86AudioLowerVolume exec wpctl set-volume @DEFAULT_AUDIO_SINK@ 5%-
bindsym --locked XF86AudioMute exec wpctl set-mute @DEFAULT_AUDIO_SINK@ toggle
bindsym --locked XF86AudioMicMute exec wpctl set-mute @DEFAULT_AUDIO_SOURCE@ toggle
bindsym --locked XF86MonBrightnessUp exec brightnessctl -e4 -n2 set 5%+
bindsym --locked XF86MonBrightnessDown exec brightnessctl -e4 -n2 set 5%-
bindsym --locked XF86AudioNext exec playerctl next
bindsym --locked XF86AudioPause exec playerctl play-pause
bindsym --locked XF86AudioPlay exec playerctl play-pause
bindsym --locked XF86AudioPrev exec playerctl previous

### WINDOW RULES ###

# Floating specific apps
for_window [app_id="pavucontrol"] floating enable
for_window [app_id="blueman-manager"] floating enable
for_window [window_role="pop-up"] floating enable
for_window [window_role="bubble"] floating enable
for_window [window_role="task_dialog"] floating enable
for_window [window_type="dialog"] floating enable
for_window [window_type="menu"] floating enable
